import{a as $}from"./chunk-CSAAT4C3.js";import{c as z,d as N,e as G,f as F,h as q}from"./chunk-KRWS2OF2.js";import{a as J}from"./chunk-L5BCGA6N.js";import{a as B}from"./chunk-E3PZJLUD.js";import{a as j}from"./chunk-CTGI6UYM.js";import{$a as A,Ab as V,Bb as U,Cb as T,Ea as c,Eb as C,Ha as s,Ja as i,Ka as e,La as h,Na as x,Oa as m,S as u,Sa as n,Ta as l,Ua as f,Va as v,W as k,_a as I,ab as R,bb as w,k as p,pa as S,ta as r,u as L,w as g,zb as D}from"./chunk-MMXZZOCS.js";var Q=()=>({exact:!0});function W(t,o){if(t&1&&(i(0,"a",35)(1,"span",6),n(2),e(),n(3," Empleados "),e()),t&2){let a=m();r(2),l(a.indiceEmpleados)}}function X(t,o){if(t&1&&(i(0,"a",36)(1,"span",6),n(2),e(),n(3," Usuarios "),e()),t&2){let a=m();r(2),l(a.indiceUsuarios)}}function Y(t,o){if(t&1&&(i(0,"a",37)(1,"span",6),n(2),e(),n(3," Auditoria "),e()),t&2){let a=m();r(2),l(a.indiceAuditoria)}}function Z(t,o){if(t&1&&(i(0,"article",25)(1,"span",24),n(2,"Empleados"),e(),i(3,"strong"),n(4),e()()),t&2){let a=m();r(4),l(a.totalEmpleados)}}function ee(t,o){if(t&1&&(i(0,"article",25)(1,"span",24),n(2,"Usuarios"),e(),i(3,"strong"),n(4),e()()),t&2){let a=m();r(4),l(a.totalUsuarios)}}function te(t,o){if(t&1&&(i(0,"article",25)(1,"span",24),n(2,"Descargas recientes"),e(),i(3,"strong"),n(4),e()()),t&2){let a=m();r(4),l(a.totalDescargasRecientes)}}function ne(t,o){t&1&&(i(0,"a",38),n(1,"Ir a empleados"),e())}function ie(t,o){t&1&&(i(0,"a",39),n(1,"Gestionar usuarios"),e())}function re(t,o){t&1&&(i(0,"a",40),n(1,"Ver auditoria"),e())}function oe(t,o){t&1&&(i(0,"p"),n(1,"Cargando..."),e())}function ae(t,o){if(t&1&&(i(0,"li")(1,"strong"),n(2),e(),i(3,"span"),n(4),e()()),t&2){let a=o.$implicit;r(2),l(a.nombre_archivo),r(2),v("",a.empleado_nombre," - ",a.tipo,"")}}function de(t,o){if(t&1&&(i(0,"ul"),c(1,ae,5,3,"li",41),e()),t&2){let a=m();r(),s("ngForOf",a.documentosRecientes)}}function se(t,o){t&1&&(i(0,"p"),n(1," No hay documentos para mostrar. "),e())}function le(t,o){t&1&&(i(0,"p"),n(1,"Disponible para admin, rrhh y gerente."),e())}function ce(t,o){t&1&&(i(0,"p"),n(1,"Cargando..."),e())}function me(t,o){if(t&1&&(i(0,"li")(1,"strong"),n(2),e(),i(3,"span"),n(4),R(5,"date"),e()()),t&2){let a=o.$implicit;r(2),l(a.usuario_nombre),r(2),v("",a.nombre_archivo," - ",w(5,3,a.fecha_descarga,"short"),"")}}function pe(t,o){if(t&1&&(i(0,"ul"),c(1,me,6,6,"li",41),e()),t&2){let a=m();r(),s("ngForOf",a.descargasRecientes)}}function ue(t,o){t&1&&(i(0,"p"),n(1," No hay descargas registradas recientemente. "),e())}var H=class t{authService=u($);router=u(N);empleadosService=u(j);usuariosService=u(J);documentosService=u(B);platformId=u(S);rolesEmpleados=["admin","rrhh"];rolesGestionUsuarios=["admin","gerente"];rolesAuditoria=["admin","rrhh","gerente"];usuarioNombre="Usuario";usuarioRol="";dashboardLoading=!0;totalDocumentosVisibles=0;totalColillasVisibles=0;totalEmpleados=0;totalUsuarios=0;totalDescargasRecientes=0;documentosRecientes=[];descargasRecientes=[];ngOnInit(){this.inicializarSesion(),this.cargarDashboard()}inicializarSesion(){if(!C(this.platformId)){this.usuarioNombre="Usuario",this.usuarioRol="";return}let o=localStorage.getItem("user");if(!o){this.usuarioNombre="Usuario",this.usuarioRol="";return}try{let a=JSON.parse(o);this.usuarioNombre=String(a?.nombre||a?.email||"Usuario"),this.usuarioRol=String(a?.rol||"").toLowerCase()}catch{this.usuarioNombre="Usuario",this.usuarioRol=""}}formatMenuIndex(o){return String(o).padStart(2,"0")}get puedeVerEmpleados(){return this.rolesEmpleados.includes(this.usuarioRol)}get puedeGestionarUsuarios(){return this.rolesGestionUsuarios.includes(this.usuarioRol)}get puedeVerAuditoria(){return this.rolesAuditoria.includes(this.usuarioRol)}get rolLabel(){return this.usuarioRol||"sin rol"}get indiceEmpleados(){return this.formatMenuIndex(2)}get indiceUsuarios(){let o=2;return this.puedeVerEmpleados&&(o+=1),this.formatMenuIndex(o)}get indiceDocumentos(){let o=2;return this.puedeVerEmpleados&&(o+=1),this.puedeGestionarUsuarios&&(o+=1),this.formatMenuIndex(o)}get indiceAuditoria(){return this.formatMenuIndex(Number(this.indiceDocumentos)+1)}cargarDashboard(){if(!C(this.platformId)){this.dashboardLoading=!1;return}this.dashboardLoading=!0;let o=this.puedeVerEmpleados?this.empleadosService.getEmpleados().pipe(g(()=>p([]))):p([]),a=this.puedeGestionarUsuarios?this.usuariosService.getUsuarios().pipe(g(()=>p([]))):p([]),d=this.documentosService.getDocumentos().pipe(g(()=>p([]))),b=this.puedeVerAuditoria?this.documentosService.getAuditoriaDescargas({limit:6}).pipe(g(()=>p([]))):p([]);L({empleados:o,usuarios:a,documentos:d,auditoria:b}).subscribe(({empleados:y,usuarios:O,documentos:M,auditoria:P})=>{let _=Array.isArray(M)?M:[],E=Array.isArray(P)?P:[];this.totalDocumentosVisibles=_.length,this.totalColillasVisibles=_.filter(K=>K?.tipo==="colilla").length,this.totalEmpleados=Array.isArray(y)?y.length:0,this.totalUsuarios=Array.isArray(O)?O.length:0,this.totalDescargasRecientes=E.length,this.documentosRecientes=_.slice(0,5),this.descargasRecientes=E.slice(0,6),this.dashboardLoading=!1})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=k({type:t,selectors:[["app-layout"]],standalone:!0,features:[I],decls:77,vars:25,consts:[[1,"layout"],[1,"sidebar"],[1,"brand-lockup"],["src","/brand/logo-moliequipos.png","alt","Logo Moliequipos",1,"brand-logo"],[1,"menu"],["routerLink","/","routerLinkActive","active",3,"routerLinkActiveOptions"],[1,"menu-index"],["routerLink","/empleados","routerLinkActive","active",4,"ngIf"],["routerLink","/usuarios","routerLinkActive","active",4,"ngIf"],["routerLink","/documentos","routerLinkActive","active"],["routerLink","/auditoria-descargas","routerLinkActive","active",4,"ngIf"],[1,"sidebar-note"],[1,"main"],[1,"header"],[1,"header-copy"],[1,"header-actions"],[1,"user"],[1,"logout",3,"click"],[1,"content"],[1,"dashboard"],[1,"dashboard-head"],[1,"btn-refresh",3,"click","disabled"],[1,"metrics-grid"],[1,"metric-card","metric-card-main"],[1,"metric-label"],[1,"metric-card"],["class","metric-card",4,"ngIf"],[1,"quick-links"],["routerLink","/documentos"],["routerLink","/empleados",4,"ngIf"],["routerLink","/usuarios",4,"ngIf"],["routerLink","/auditoria-descargas",4,"ngIf"],[1,"dashboard-panels"],[1,"panel-card"],[4,"ngIf"],["routerLink","/empleados","routerLinkActive","active"],["routerLink","/usuarios","routerLinkActive","active"],["routerLink","/auditoria-descargas","routerLinkActive","active"],["routerLink","/empleados"],["routerLink","/usuarios"],["routerLink","/auditoria-descargas"],[4,"ngFor","ngForOf"]],template:function(a,d){a&1&&(i(0,"div",0)(1,"aside",1)(2,"div",2),h(3,"img",3),e(),i(4,"nav",4)(5,"a",5)(6,"span",6),n(7,"01"),e(),n(8," Dashboard "),e(),c(9,W,4,1,"a",7)(10,X,4,1,"a",8),i(11,"a",9)(12,"span",6),n(13),e(),n(14," Documentos "),e(),c(15,Y,4,1,"a",10),e(),i(16,"p",11),n(17,"Panel interno de gestion operativa"),e()(),i(18,"div",12)(19,"header",13)(20,"div",14)(21,"strong"),n(22,"Panel de control"),e(),i(23,"span"),n(24,"Gestion de empleados y documentos"),e()(),i(25,"div",15)(26,"span",16),n(27),i(28,"small"),n(29),e()(),i(30,"button",17),x("click",function(){return d.logout()}),n(31,"Cerrar sesion"),e()()(),i(32,"main",18)(33,"section",19)(34,"div",20)(35,"div")(36,"h2"),n(37,"Resumen operativo"),e(),i(38,"p"),n(39,"Vista rapida de actividad, documentos y control de acceso."),e()(),i(40,"button",21),x("click",function(){return d.cargarDashboard()}),n(41),e()(),i(42,"div",22)(43,"article",23)(44,"span",24),n(45,"Documentos visibles"),e(),i(46,"strong"),n(47),e()(),i(48,"article",25)(49,"span",24),n(50,"Colillas visibles"),e(),i(51,"strong"),n(52),e()(),c(53,Z,5,1,"article",26)(54,ee,5,1,"article",26)(55,te,5,1,"article",26),e(),i(56,"div",27)(57,"a",28),n(58,"Ir a documentos"),e(),c(59,ne,2,0,"a",29)(60,ie,2,0,"a",30)(61,re,2,0,"a",31),e(),i(62,"div",32)(63,"article",33)(64,"h3"),n(65,"Ultimos documentos"),e(),c(66,oe,2,0,"p",34)(67,de,2,1,"ul",34)(68,se,2,0,"p",34),e(),i(69,"article",33)(70,"h3"),n(71,"Actividad de descargas"),e(),c(72,le,2,0,"p",34)(73,ce,2,0,"p",34)(74,pe,2,1,"ul",34)(75,ue,2,0,"p",34),e()()(),h(76,"router-outlet"),e()()()),a&2&&(r(5),s("routerLinkActiveOptions",A(24,Q)),r(4),s("ngIf",d.puedeVerEmpleados),r(),s("ngIf",d.puedeGestionarUsuarios),r(3),l(d.indiceDocumentos),r(2),s("ngIf",d.puedeVerAuditoria),r(12),f(" ",d.usuarioNombre," "),r(2),f("(",d.rolLabel,")"),r(11),s("disabled",d.dashboardLoading),r(),f(" ",d.dashboardLoading?"Actualizando...":"Actualizar"," "),r(6),l(d.totalDocumentosVisibles),r(5),l(d.totalColillasVisibles),r(),s("ngIf",d.puedeVerEmpleados),r(),s("ngIf",d.puedeGestionarUsuarios),r(),s("ngIf",d.puedeVerAuditoria),r(4),s("ngIf",d.puedeVerEmpleados),r(),s("ngIf",d.puedeGestionarUsuarios),r(),s("ngIf",d.puedeVerAuditoria),r(5),s("ngIf",d.dashboardLoading),r(),s("ngIf",!d.dashboardLoading&&d.documentosRecientes.length),r(),s("ngIf",!d.dashboardLoading&&!d.documentosRecientes.length),r(4),s("ngIf",!d.puedeVerAuditoria),r(),s("ngIf",d.puedeVerAuditoria&&d.dashboardLoading),r(),s("ngIf",d.puedeVerAuditoria&&!d.dashboardLoading&&d.descargasRecientes.length),r(),s("ngIf",d.puedeVerAuditoria&&!d.dashboardLoading&&!d.descargasRecientes.length))},dependencies:[T,D,V,U,z,q,G,F],styles:[".layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:290px minmax(0,1fr);min-height:100vh}.sidebar[_ngcontent-%COMP%]{background:linear-gradient(160deg,#ffd70024,#ffd70000 35%),linear-gradient(180deg,#171717,#101010);color:#f5f5f5;border-right:1px solid rgba(247,219,33,.22);padding:1.35rem 1.1rem;display:flex;flex-direction:column;gap:1.4rem}.brand-lockup[_ngcontent-%COMP%]{padding:.55rem;border:1px solid rgba(247,219,33,.26);border-radius:14px;background:linear-gradient(180deg,#fff,#f8f8f2);box-shadow:inset 0 1px #ffffffbf}.brand-logo[_ngcontent-%COMP%]{display:block;width:100%;max-width:180px;margin:0 auto;height:auto}.menu[_ngcontent-%COMP%]{display:grid;gap:.55rem}.menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;display:flex;align-items:center;gap:.6rem;border-radius:11px;padding:.7rem .78rem;color:#ffffffdb;border:1px solid transparent;background:#ffffff05}.menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#fff;background:#f7db211f;border-color:#f7db2142}.menu[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#141414;background:linear-gradient(135deg,var(--brand-yellow) 0%,var(--brand-yellow-strong) 100%);border-color:#ffd700b3;box-shadow:0 12px 22px #00000042}.menu-index[_ngcontent-%COMP%]{min-width:28px;text-align:center;border-radius:999px;padding:.12rem .45rem;font-weight:700;font-size:.7rem;letter-spacing:.08em;background:#ffffff1a}.menu[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]   .menu-index[_ngcontent-%COMP%]{background:#14141429}.sidebar-note[_ngcontent-%COMP%]{margin-top:auto;font-size:.74rem;line-height:1.3;letter-spacing:.04em;color:#ffffff9e}.main[_ngcontent-%COMP%]{min-width:0;display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{min-height:72px;border-bottom:1px solid var(--border);background:linear-gradient(90deg,#fff,#faf9f0);display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.9rem 1.3rem}.header-copy[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.06rem}.header-copy[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.1rem;font-family:var(--font-head);letter-spacing:.04em}.header-copy[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.82rem;color:var(--text-soft)}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.65rem}.user[_ngcontent-%COMP%]{font-size:.83rem;border:1px solid var(--border);border-radius:999px;background:#fff;padding:.35rem .75rem;display:inline-flex;gap:.35rem;align-items:center}.user[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-soft);text-transform:lowercase}.logout[_ngcontent-%COMP%]{border:none;border-radius:9px;background:#1e1e1e;color:#fff;padding:.5rem .85rem;font-weight:600;cursor:pointer}.logout[_ngcontent-%COMP%]:hover{background:#000}.content[_ngcontent-%COMP%]{padding:1rem 1.15rem;overflow:auto}.dashboard[_ngcontent-%COMP%]{background:radial-gradient(circle at 95% 8%,rgba(247,219,33,.2),transparent 36%),linear-gradient(180deg,#fff,#fefdf8);border:1px solid var(--border);border-radius:18px;padding:1rem;box-shadow:var(--shadow-sm);margin-bottom:1rem}.dashboard-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:.9rem;margin-bottom:.9rem}.dashboard-head[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.35rem}.dashboard-head[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.18rem 0 0;color:var(--text-soft);font-size:.85rem}.btn-refresh[_ngcontent-%COMP%]{border:1px solid #1f1f1f;background:#1f1f1f;color:#fff;border-radius:9px;padding:.48rem .84rem;font-weight:700;cursor:pointer;font-size:.8rem}.btn-refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:#000}.btn-refresh[_ngcontent-%COMP%]:disabled{opacity:.62;cursor:not-allowed}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.65rem;margin-bottom:.85rem}.metric-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:12px;padding:.72rem .75rem;background:#fff;display:grid;gap:.35rem}.metric-card[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1}.metric-card-main[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f7db213d,#ffffffe0)}.metric-label[_ngcontent-%COMP%]{font-size:.76rem;color:var(--text-soft);font-weight:700;letter-spacing:.05em;text-transform:uppercase}.quick-links[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.9rem}.quick-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;background:#f1f1e7;color:#1d1d1d;border:1px solid #dcdccd;border-radius:10px;padding:.4rem .68rem;font-size:.78rem;font-weight:700}.quick-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#e5e5d7}.dashboard-panels[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:.75rem}.panel-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:12px;background:#fff;padding:.72rem}.panel-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .62rem;font-size:.98rem}.panel-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-soft);font-size:.83rem}.panel-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none;display:grid;gap:.5rem}.panel-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:grid;gap:.1rem;border:1px solid #ececde;border-radius:10px;padding:.42rem .52rem;background:#fffef7}.panel-card[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:.84rem;color:#1a1a1a}.panel-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.76rem;color:var(--text-soft)}@media (max-width: 960px){.layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.sidebar[_ngcontent-%COMP%]{border-right:0;border-bottom:1px solid rgba(247,219,33,.24);padding:.95rem;gap:.95rem}.menu[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.sidebar-note[_ngcontent-%COMP%]{margin-top:.15rem}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;padding:.8rem .95rem}.header-actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.content[_ngcontent-%COMP%]{padding:.9rem}.dashboard-head[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}"]})};export{H as LayoutComponent};
