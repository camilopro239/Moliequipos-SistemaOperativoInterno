import{a as Y}from"./chunk-JEO34WBT.js";import{a as R,b as C,c as L,d as j,e as U,f as B,g as G,h as $,i as q,j as W,k as H,l as J,m as K,n as Q}from"./chunk-OWGPU7TU.js";import{b as A}from"./chunk-KRWS2OF2.js";import{a as Z}from"./chunk-E3PZJLUD.js";import{a as X}from"./chunk-CTGI6UYM.js";import{$a as I,Ab as T,Bb as F,Cb as z,Ea as m,Eb as v,Ha as s,Ja as o,Ka as t,La as E,Ma as h,Na as _,Oa as c,S as u,Sa as i,Ta as b,Ua as x,Va as P,W as S,Wa as y,Xa as O,Ya as D,_a as w,ab as k,bb as V,ca as g,da as f,pa as M,ta as l,zb as N}from"./chunk-MMXZZOCS.js";var te=()=>({standalone:!0});function oe(a,n){a&1&&(o(0,"p",11),i(1," Mostrando tus colillas de pago. Solo puedes ver y descargar documentos de tu propio perfil. "),t())}function ne(a,n){if(a&1&&(o(0,"option",26),i(1),t()),a&2){let e=n.$implicit;s("ngValue",e.id),l(),P(" ",e.nombre," - ",e.cedula," ")}}function ie(a,n){if(a&1&&(o(0,"small"),i(1),t()),a&2){let e=c(2);l(),b(e.archivoSeleccionado.name)}}function re(a,n){if(a&1){let e=h();o(0,"div",6)(1,"h3"),i(2,"Subir documento"),t(),o(3,"form",12),_("ngSubmit",function(){g(e);let d=c();return f(d.subirDocumento())}),o(4,"div",13)(5,"label"),i(6,"Empleado"),t(),o(7,"select",14)(8,"option",15),i(9,"Selecciona un empleado"),t(),m(10,ne,2,3,"option",16),t()(),o(11,"div",13)(12,"label"),i(13,"Tipo"),t(),o(14,"select",17)(15,"option",18),i(16,"Contrato"),t(),o(17,"option",19),i(18,"Incapacidad"),t(),o(19,"option",20),i(20,"Colilla"),t(),o(21,"option",21),i(22,"Otro"),t()()(),o(23,"div",13)(24,"label"),i(25,"Periodo (opcional)"),t(),E(26,"input",22),t(),o(27,"div",13)(28,"label"),i(29,"Archivo"),t(),o(30,"input",23),_("change",function(d){g(e);let p=c();return f(p.onArchivoSeleccionado(d))}),t(),m(31,ie,2,1,"small",9),t(),o(32,"div",24)(33,"button",25),i(34),t()()()()}if(a&2){let e=c();l(3),s("formGroup",e.form),l(5),s("ngValue",null),l(2),s("ngForOf",e.empleados),l(21),s("ngIf",e.archivoSeleccionado),l(2),s("disabled",e.subiendo||e.form.invalid),l(),x(" ",e.subiendo?"Subiendo...":"Subir documento"," ")}}function ae(a,n){if(a&1&&(o(0,"option",30),i(1),t()),a&2){let e=n.$implicit;s("value",e.id),l(),x(" ",e.nombre," ")}}function le(a,n){if(a&1){let e=h();o(0,"select",27),D("ngModelChange",function(d){g(e);let p=c();return O(p.filtroEmpleadoId,d)||(p.filtroEmpleadoId=d),f(d)}),_("ngModelChange",function(){g(e);let d=c();return f(d.cargarDocumentos())}),o(1,"option",28),i(2,"Todos los empleados"),t(),m(3,ae,2,2,"option",29),t()}if(a&2){let e=c();y("ngModel",e.filtroEmpleadoId),s("ngModelOptions",I(3,te)),l(3),s("ngForOf",e.empleados)}}function de(a,n){a&1&&(o(0,"p"),i(1,"Cargando documentos..."),t())}function se(a,n){if(a&1){let e=h();o(0,"button",37),_("click",function(){g(e);let d=c().$implicit,p=c(2);return f(p.eliminarDocumento(d))}),i(1," Eliminar "),t()}}function ce(a,n){if(a&1){let e=h();o(0,"tr")(1,"td"),i(2),t(),o(3,"td",33),i(4),t(),o(5,"td"),i(6),t(),o(7,"td"),i(8),t(),o(9,"td"),i(10),k(11,"date"),t(),o(12,"td",34)(13,"button",35),_("click",function(){let d=g(e).$implicit,p=c(2);return f(p.descargarDocumento(d))}),i(14," Descargar "),t(),m(15,se,2,0,"button",36),t()()}if(a&2){let e=n.$implicit,r=c(2);l(2),b(e.empleado_nombre),l(2),b(e.tipo),l(2),b(e.nombre_archivo),l(2),b(e.periodo||"-"),l(2),b(V(11,6,e.fecha_subida,"short")),l(5),s("ngIf",r.esPrivilegiado)}}function me(a,n){if(a&1&&(o(0,"div",31)(1,"table")(2,"thead")(3,"tr")(4,"th"),i(5,"Empleado"),t(),o(6,"th"),i(7,"Tipo"),t(),o(8,"th"),i(9,"Archivo"),t(),o(10,"th"),i(11,"Periodo"),t(),o(12,"th"),i(13,"Fecha"),t(),o(14,"th"),i(15,"Acciones"),t()()(),o(16,"tbody"),m(17,ce,16,9,"tr",32),t()()()),a&2){let e=c();l(17),s("ngForOf",e.documentos)}}function pe(a,n){a&1&&(o(0,"p"),i(1,"No hay documentos registrados."),t())}var ee=class a{fb=u(J);empleadosService=u(X);documentosService=u(Z);toast=u(Y);platformId=u(M);route=u(A);empleados=[];documentos=[];esPrivilegiado=!1;loading=!0;subiendo=!1;filtroEmpleadoId="";archivoSeleccionado=null;form=this.fb.group({empleado_id:[null,C.required],tipo:["contrato",C.required],periodo:[""]});ngOnInit(){if(!v(this.platformId)){this.loading=!1;return}this.inicializarPermisos(),this.cargarEmpleados(),this.route.queryParamMap.subscribe(n=>{let e=n.get("empleado_id"),r=Number(e);this.filtroEmpleadoId=r>0?String(r):"",this.form.patchValue({empleado_id:r>0?r:null}),this.cargarDocumentos()})}inicializarPermisos(){let n=localStorage.getItem("user");if(!n){this.esPrivilegiado=!1;return}try{let r=(JSON.parse(n)?.rol||"").toLowerCase();this.esPrivilegiado=["admin","rrhh","gerente"].includes(r)}catch{this.esPrivilegiado=!1}}retornar(){v(this.platformId)&&window.history.back()}cargarEmpleados(){if(!this.esPrivilegiado){this.empleados=[];return}this.empleadosService.getEmpleados().subscribe({next:n=>{this.empleados=n},error:()=>{this.toast.error("No se pudieron cargar los empleados")}})}cargarDocumentos(){this.loading=!0;let n=this.filtroEmpleadoId&&Number(this.filtroEmpleadoId)>0?Number(this.filtroEmpleadoId):null;this.documentosService.getDocumentos(n).subscribe({next:e=>{this.documentos=e,this.loading=!1},error:()=>{this.toast.error("No se pudieron cargar los documentos"),this.loading=!1}})}onArchivoSeleccionado(n){let e=n.target;this.archivoSeleccionado=e.files&&e.files.length?e.files[0]:null}subirDocumento(){if(this.form.invalid){this.form.markAllAsTouched();return}if(!this.esPrivilegiado){this.toast.error("No tienes permisos para subir documentos");return}if(!this.archivoSeleccionado){this.toast.warning("Debes seleccionar un archivo");return}let n=this.form.getRawValue(),e=new FormData;e.append("empleado_id",String(n.empleado_id)),e.append("tipo",String(n.tipo)),e.append("archivo",this.archivoSeleccionado);let r=(n.periodo??"").trim();r&&e.append("periodo",r),this.subiendo=!0,this.documentosService.subirDocumento(e).subscribe({next:()=>{this.toast.success("Documento cargado correctamente"),this.subiendo=!1,this.archivoSeleccionado=null,this.form.patchValue({tipo:"contrato",periodo:""}),this.cargarDocumentos()},error:d=>{this.subiendo=!1,this.toast.error(d?.error?.error||"No se pudo cargar el documento")}})}descargarDocumento(n){v(this.platformId)&&this.documentosService.descargarDocumento(n.id).subscribe({next:e=>{let r=URL.createObjectURL(e),d=document.createElement("a");d.href=r,d.download=n.nombre_archivo||"documento",document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(r)},error:e=>{this.toast.error(e?.error?.error||"No se pudo descargar el documento")}})}eliminarDocumento(n){if(!this.esPrivilegiado){this.toast.error("No tienes permisos para eliminar documentos");return}confirm(`Deseas eliminar el documento "${n.nombre_archivo}"?`)&&this.documentosService.eliminarDocumento(n.id).subscribe({next:()=>{this.toast.success("Documento eliminado"),this.cargarDocumentos()},error:r=>{this.toast.error(r?.error?.error||"No se pudo eliminar el documento")}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=S({type:a,selectors:[["app-documentos"]],standalone:!0,features:[w],decls:17,vars:6,consts:[[1,"page"],[1,"page-header"],[1,"page-header-left"],["type","button",1,"btn-retorno",3,"click"],["class","permiso-info",4,"ngIf"],["class","panel",4,"ngIf"],[1,"panel"],[1,"panel-header"],[3,"ngModel","ngModelOptions","ngModelChange",4,"ngIf"],[4,"ngIf"],["class","table-wrapper",4,"ngIf"],[1,"permiso-info"],[1,"form-grid",3,"ngSubmit","formGroup"],[1,"field"],["formControlName","empleado_id"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["formControlName","tipo"],["value","contrato"],["value","incapacidad"],["value","colilla"],["value","otro"],["type","text","formControlName","periodo","placeholder","Ej: 2026-02"],["type","file",3,"change"],[1,"actions"],["type","submit",1,"primary",3,"disabled"],[3,"ngValue"],[3,"ngModelChange","ngModel","ngModelOptions"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"table-wrapper"],[4,"ngFor","ngForOf"],[1,"capitalize"],[1,"acciones"],["type","button",1,"secondary",3,"click"],["type","button","class","btn-eliminar",3,"click",4,"ngIf"],["type","button",1,"btn-eliminar",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),_("click",function(){return r.retornar()}),i(4," Retornar "),t(),o(5,"h2"),i(6,"Documentos de empleados"),t()()(),m(7,oe,2,0,"p",4)(8,re,35,6,"div",5),o(9,"div",6)(10,"div",7)(11,"h3"),i(12,"Listado de documentos"),t(),m(13,le,4,4,"select",8),t(),m(14,de,2,0,"p",9)(15,me,18,1,"div",10)(16,pe,2,0,"p",9),t()()),e&2&&(l(7),s("ngIf",!r.esPrivilegiado),l(),s("ngIf",r.esPrivilegiado),l(5),s("ngIf",r.esPrivilegiado),l(),s("ngIf",r.loading),l(),s("ngIf",!r.loading&&r.documentos.length),l(),s("ngIf",!r.loading&&!r.documentos.length))},dependencies:[z,N,T,F,Q,B,W,H,R,q,L,j,G,$,K,U],styles:[".page[_ngcontent-%COMP%]{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow-sm);padding:1.12rem}.page-header[_ngcontent-%COMP%]{margin-bottom:.95rem}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.52rem}.page-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.65rem}.btn-retorno[_ngcontent-%COMP%]{border:1px solid #2d2d2d;background:#fff;color:#1a1a1a;border-radius:9px;padding:.42rem .75rem;font-size:.81rem;font-weight:700;cursor:pointer}.btn-retorno[_ngcontent-%COMP%]:hover{background:#f2f2ed}.permiso-info[_ngcontent-%COMP%]{margin-bottom:.9rem;padding:.62rem .72rem;border-radius:10px;border:1px solid #f0db67;background:#fffbe7;color:#766004;font-size:.85rem;font-weight:600}.panel[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:14px;padding:.95rem;margin-bottom:1rem;background:linear-gradient(180deg,#fff,#fbfbf7)}.panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:.84rem;font-size:1.07rem}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:.7rem;margin-bottom:.9rem;flex-wrap:wrap}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.8rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.28rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-soft);font-weight:600}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.52rem .62rem;border:1px solid var(--border);border-radius:10px;font-size:.88rem;background:#fff}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#a69000;box-shadow:0 0 0 3px #f7db2138}small[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-soft)}.actions[_ngcontent-%COMP%]{display:flex;align-items:end}.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--brand-yellow) 0%,var(--brand-yellow-strong) 100%);color:#191919;border:none;padding:.55rem .95rem;border-radius:10px;cursor:pointer;font-size:.86rem;font-weight:700}.primary[_ngcontent-%COMP%]:hover:not(:disabled){box-shadow:0 10px 16px #11111126}.primary[_ngcontent-%COMP%]:disabled{opacity:.62;cursor:not-allowed}.secondary[_ngcontent-%COMP%]{background:#ebebe3;color:#1f1f1f;border:1px solid #d8d8cf;padding:.44rem .78rem;border-radius:9px;cursor:pointer;font-size:.8rem;font-weight:600}.secondary[_ngcontent-%COMP%]:hover{background:#e2e2d8}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;border:1px solid var(--border);border-radius:12px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.88rem}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;background:#1f1f1f;color:#f6f6f6;padding:.65rem;border-bottom:1px solid #333;font-weight:600}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.64rem;border-bottom:1px solid #ebebe3}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#fffde8}.acciones[_ngcontent-%COMP%]{display:flex;gap:.5rem}.btn-eliminar[_ngcontent-%COMP%]{background-color:transparent;color:var(--danger);border:1px solid var(--danger);border-radius:7px;padding:.34rem .56rem;font-size:.74rem;cursor:pointer}.btn-eliminar[_ngcontent-%COMP%]:hover{background-color:var(--danger);color:#fff}.capitalize[_ngcontent-%COMP%]{text-transform:capitalize}@media (max-width: 760px){.page[_ngcontent-%COMP%]{padding:.82rem}}"]})};export{ee as DocumentosComponent};
