import{a as V}from"./chunk-JEO34WBT.js";import{a as k,c as N,e as W,i as L,j as z,k as B,m as H}from"./chunk-OWGPU7TU.js";import{a as j}from"./chunk-E3PZJLUD.js";import{a as R}from"./chunk-CTGI6UYM.js";import{$a as f,Ab as I,Bb as A,Cb as T,Ea as h,Eb as S,Ha as d,Ja as e,Ka as t,Na as v,Oa as x,S as _,Sa as i,Ta as p,Ua as O,Va as M,W as E,Wa as c,Xa as g,Ya as u,_a as P,ab as D,bb as w,pa as y,ta as a,zb as F}from"./chunk-MMXZZOCS.js";var b=()=>({standalone:!0});function G(l,s){if(l&1&&(e(0,"option",25),i(1),t()),l&2){let n=s.$implicit;d("value",n.id),a(),M(" ",n.nombre," - ",n.cedula," ")}}function J(l,s){l&1&&(e(0,"p"),i(1,"Cargando auditoria..."),t())}function K(l,s){if(l&1&&(e(0,"small"),i(1),t()),l&2){let n=x().$implicit;a(),O("Periodo: ",n.periodo,"")}}function Q(l,s){if(l&1&&(e(0,"tr")(1,"td"),i(2),D(3,"date"),t(),e(4,"td")(5,"div"),i(6),t(),e(7,"small"),i(8),t()(),e(9,"td")(10,"div"),i(11),t(),e(12,"small"),i(13),t()(),e(14,"td",28),i(15),t(),e(16,"td")(17,"span",29),i(18),t(),h(19,K,2,1,"small",23),t(),e(20,"td"),i(21),t()()),l&2){let n=s.$implicit;a(2),p(w(3,11,n.fecha_descarga,"short")),a(4),p(n.usuario_nombre),a(2),M("",n.usuario_email," (",n.usuario_rol,")"),a(3),p(n.empleado_nombre),a(2),p(n.empleado_cedula),a(2),p(n.tipo_documento),a(2),d("title",n.user_agent||""),a(),p(n.nombre_archivo),a(),d("ngIf",n.periodo),a(2),p(n.ip||"-")}}function X(l,s){if(l&1&&(e(0,"div",26)(1,"table")(2,"thead")(3,"tr")(4,"th"),i(5,"Fecha"),t(),e(6,"th"),i(7,"Usuario"),t(),e(8,"th"),i(9,"Empleado"),t(),e(10,"th"),i(11,"Tipo"),t(),e(12,"th"),i(13,"Archivo"),t(),e(14,"th"),i(15,"IP"),t()()(),e(16,"tbody"),h(17,Q,22,14,"tr",27),t()()()),l&2){let n=x();a(17),d("ngForOf",n.registros)}}function Y(l,s){l&1&&(e(0,"p"),i(1,"No hay eventos de descarga para los filtros aplicados."),t())}var U=class l{empleadosService=_(R);documentosService=_(j);toast=_(V);platformId=_(y);loading=!0;empleados=[];registros=[];filtroEmpleadoId="";filtroTipoDocumento="";filtroFechaDesde="";filtroFechaHasta="";filtroLimite="100";ngOnInit(){if(!S(this.platformId)){this.loading=!1;return}this.cargarEmpleados(),this.cargarAuditoria()}retornar(){S(this.platformId)&&window.history.back()}cargarEmpleados(){this.empleadosService.getEmpleados().subscribe({next:s=>{this.empleados=s},error:()=>{this.toast.error("No se pudieron cargar los empleados para el filtro")}})}aplicarFiltros(){this.cargarAuditoria()}limpiarFiltros(){this.filtroEmpleadoId="",this.filtroTipoDocumento="",this.filtroFechaDesde="",this.filtroFechaHasta="",this.filtroLimite="100",this.cargarAuditoria()}cargarAuditoria(){this.loading=!0;let s=this.filtroEmpleadoId&&Number(this.filtroEmpleadoId)>0?Number(this.filtroEmpleadoId):null,n=this.filtroTipoDocumento.trim(),o=this.filtroFechaDesde.trim(),m=this.filtroFechaHasta.trim(),r=Number(this.filtroLimite),q=Number.isFinite(r)&&r>0?r:100;this.documentosService.getAuditoriaDescargas({empleado_id:s,tipo_documento:n||void 0,fecha_desde:o||void 0,fecha_hasta:m||void 0,limit:q}).subscribe({next:C=>{this.registros=C,this.loading=!1},error:C=>{this.loading=!1,this.toast.error(C?.error?.error||"No se pudo cargar la auditoria de descargas")}})}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=E({type:l,selectors:[["app-auditoria-descargas"]],standalone:!0,features:[P],decls:64,vars:19,consts:[[1,"page"],[1,"page-header"],[1,"page-header-left"],["type","button",1,"btn-retorno",3,"click"],[1,"panel"],[1,"panel-header"],[1,"form-grid"],[1,"field"],[3,"ngModelChange","ngModel","ngModelOptions"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","contrato"],["value","incapacidad"],["value","colilla"],["value","otro"],["type","date",3,"ngModelChange","ngModel","ngModelOptions"],["value","50"],["value","100"],["value","200"],["value","500"],[1,"actions"],["type","button",1,"primary",3,"click"],["type","button",1,"secondary",3,"click"],[4,"ngIf"],["class","table-wrapper",4,"ngIf"],[3,"value"],[1,"table-wrapper"],[4,"ngFor","ngForOf"],[1,"capitalize"],[3,"title"]],template:function(n,o){n&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),v("click",function(){return o.retornar()}),i(4," Retornar "),t(),e(5,"h2"),i(6,"Auditoria de descargas"),t()()(),e(7,"div",4)(8,"div",5)(9,"h3"),i(10,"Filtros"),t()(),e(11,"div",6)(12,"div",7)(13,"label"),i(14,"Empleado"),t(),e(15,"select",8),u("ngModelChange",function(r){return g(o.filtroEmpleadoId,r)||(o.filtroEmpleadoId=r),r}),e(16,"option",9),i(17,"Todos"),t(),h(18,G,2,3,"option",10),t()(),e(19,"div",7)(20,"label"),i(21,"Tipo documento"),t(),e(22,"select",8),u("ngModelChange",function(r){return g(o.filtroTipoDocumento,r)||(o.filtroTipoDocumento=r),r}),e(23,"option",9),i(24,"Todos"),t(),e(25,"option",11),i(26,"Contrato"),t(),e(27,"option",12),i(28,"Incapacidad"),t(),e(29,"option",13),i(30,"Colilla"),t(),e(31,"option",14),i(32,"Otro"),t()()(),e(33,"div",7)(34,"label"),i(35,"Fecha desde"),t(),e(36,"input",15),u("ngModelChange",function(r){return g(o.filtroFechaDesde,r)||(o.filtroFechaDesde=r),r}),t()(),e(37,"div",7)(38,"label"),i(39,"Fecha hasta"),t(),e(40,"input",15),u("ngModelChange",function(r){return g(o.filtroFechaHasta,r)||(o.filtroFechaHasta=r),r}),t()(),e(41,"div",7)(42,"label"),i(43,"Limite"),t(),e(44,"select",8),u("ngModelChange",function(r){return g(o.filtroLimite,r)||(o.filtroLimite=r),r}),e(45,"option",16),i(46,"50"),t(),e(47,"option",17),i(48,"100"),t(),e(49,"option",18),i(50,"200"),t(),e(51,"option",19),i(52,"500"),t()()(),e(53,"div",20)(54,"button",21),v("click",function(){return o.aplicarFiltros()}),i(55," Aplicar filtros "),t(),e(56,"button",22),v("click",function(){return o.limpiarFiltros()}),i(57," Limpiar "),t()()()(),e(58,"div",4)(59,"h3"),i(60,"Eventos de descarga"),t(),h(61,J,2,0,"p",23)(62,X,18,1,"div",24)(63,Y,2,0,"p",23),t()()),n&2&&(a(15),c("ngModel",o.filtroEmpleadoId),d("ngModelOptions",f(14,b)),a(3),d("ngForOf",o.empleados),a(4),c("ngModel",o.filtroTipoDocumento),d("ngModelOptions",f(15,b)),a(14),c("ngModel",o.filtroFechaDesde),d("ngModelOptions",f(16,b)),a(4),c("ngModel",o.filtroFechaHasta),d("ngModelOptions",f(17,b)),a(4),c("ngModel",o.filtroLimite),d("ngModelOptions",f(18,b)),a(17),d("ngIf",o.loading),a(),d("ngIf",!o.loading&&o.registros.length),a(),d("ngIf",!o.loading&&!o.registros.length))},dependencies:[T,F,I,A,H,z,B,k,L,N,W],styles:[".page[_ngcontent-%COMP%]{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow-sm);padding:1.12rem}.page-header[_ngcontent-%COMP%]{margin-bottom:.95rem}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.52rem}.page-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.65rem}.btn-retorno[_ngcontent-%COMP%]{border:1px solid #2d2d2d;background:#fff;color:#1a1a1a;border-radius:9px;padding:.42rem .75rem;font-size:.81rem;font-weight:700;cursor:pointer}.btn-retorno[_ngcontent-%COMP%]:hover{background:#f2f2ed}.panel[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:14px;padding:.95rem;margin-bottom:1rem;background:linear-gradient(180deg,#fff,#fbfbf7)}.panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:.84rem;font-size:1.07rem}.panel-header[_ngcontent-%COMP%]{margin-bottom:.9rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.8rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.28rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-soft);font-weight:600}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.52rem .62rem;border:1px solid var(--border);border-radius:10px;font-size:.88rem;background:#fff}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#a69000;box-shadow:0 0 0 3px #f7db2138}small[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-soft)}.actions[_ngcontent-%COMP%]{display:flex;align-items:end;gap:.5rem}.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--brand-yellow) 0%,var(--brand-yellow-strong) 100%);color:#191919;border:none;padding:.55rem .95rem;border-radius:10px;cursor:pointer;font-size:.86rem;font-weight:700}.primary[_ngcontent-%COMP%]:hover:not(:disabled){box-shadow:0 10px 16px #11111126}.secondary[_ngcontent-%COMP%]{background:#ebebe3;color:#1f1f1f;border:1px solid #d8d8cf;padding:.55rem .95rem;border-radius:10px;cursor:pointer;font-size:.86rem;font-weight:700}.secondary[_ngcontent-%COMP%]:hover{background:#e2e2d8}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;border:1px solid var(--border);border-radius:12px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.88rem}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;background:#1f1f1f;color:#f6f6f6;padding:.65rem;border-bottom:1px solid #333;font-weight:600}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.64rem;border-bottom:1px solid #ebebe3;vertical-align:top}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#fffde8}.capitalize[_ngcontent-%COMP%]{text-transform:capitalize}@media (max-width: 760px){.page[_ngcontent-%COMP%]{padding:.82rem}.actions[_ngcontent-%COMP%]{grid-column:1/-1;flex-wrap:wrap}}"]})};export{U as AuditoriaDescargasComponent};
